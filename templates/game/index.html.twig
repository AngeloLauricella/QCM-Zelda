{% extends 'base.html.twig' %}

{% block title %}Zelda: Ocarina of Time - Menu Principal
{% endblock %}

{% block body %}
	<header class="game-header">
		<h1>{{ player.name }}, bienvenue!</h1>
		<p class="subtitle">L'aventure t'attend</p>
	</header>

	<main class="game-main container_profile ">
		<section class="player-stats">
			<div class="hearts-display">
				<span class="label">CÅ“urs:</span>
				<div class="hearts-container">
					{% for i in 1..maxHearts %}
						<span class="heart{% if i <= hearts %} active{% endif %}">
							<img class="card-rubis" src="{{ asset('images/coeur.png') }}">
						</span>
					{% endfor %}
				</div>
				<span class="count">{{ hearts }}/{{ maxHearts }}</span>
			</div>

			<div class="points-display">
				<span class="label">Points:</span>
				<span class="points-value">{{ points }}</span>
			</div>

			<div class="shop-points-display">
				<span class="label">Points Boutique:</span>
				<span class="shop-points-value">{{ player.shopPoints }}
					<img class="card-rubis" src="{{ asset('images/rubis.png') }}">
				</span>
			</div>
		</section>

		{% if isGameOver %}
			<section class="game-over-section">
				<h2>ğŸ® GAME OVER ğŸ®</h2>

				<div class="final-stats">
					<p class="game-over-reason">{{ gameOverReason ?? 'Tu as perdu tous tes cÅ“urs...' }}</p>
					<p class="final-score">Score Final:
						<strong>{{ points }}</strong>
						points</p>
					<p class="shop-points-earned">
						Points Boutique Ã  gagner:
						<strong>{{ (points / 10)|round(0, 'floor') }}</strong>
						ğŸ’
					</p>
				</div>

				<div class="game-over-actions">
					<form action="{{ path('game_restart') }}" method="post">
						<button type="submit" class="btn btn-restart">Rejouer et Enregistrer le Score</button>
					</form>
					<a href="{{ path('app_score_index') }}" class="btn btn-scores">Voir les Classements</a>
					<a href="{{ path('gallery_shop_index') }}" class="btn btn-shop">ğŸ›’ Boutique</a>
				</div>
			</section>
		{% else %}
			<section class="zones-container">
				<h2>ğŸ—ºï¸ Zones d'Aventure</h2>

				{% if unlockedZones is empty and completedZones is empty %}
					<div class="intro-message">
						<h3>Bienvenue en Hyrule!</h3>
						<p>Ton aventure commence maintenant. Explore les terres d'Hyrule et rÃ©ponds aux dÃ©fis qui t'attendent!</p>
						<form action="{{ path('game_new') }}" method="post">
							<button type="submit" class="btn btn-start-adventure">ğŸ® Commencer l'Aventure</button>
						</form>
					</div>
				{% else %}
					<!-- Zone en Cours de Jeu -->
					{% if currentZone %}
						<div class="current-zone-section">
							<h3>Zone Actuelle</h3>
							<div class="zone-card current">
								<div class="zone-header">
									<h4>{{ currentZone.name }}</h4>
									<span class="zone-badge badge-current">EN COURS</span>
								</div>
								<p class="zone-description">{{ currentZone.description }}</p>
								<div class="zone-stats-mini">
									{% set zoneProgress = null %}
									{% for item in unlockedZones %}
										{% if item.zone.id == currentZone.id %}
											{% set zoneProgress = item.progress %}
										{% endif %}
									{% endfor %}
									{% if zoneProgress %}
										<div class="stat">
											<span class="label">Questions:</span>
											<span class="value">{{ zoneProgress.questionsAnswered }}/{{ currentZone.questions|length }}</span>
										</div>
										<div class="stat">
											<span class="label">Score Zone:</span>
											<span class="value">{{ zoneProgress.zoneScore }}</span>
										</div>
										<div class="stat">
											<span class="label">RÃ©ussite:</span>
											{% if zoneProgress.questionsAnswered > 0 %}
												<span class="value">{{ zoneProgress.progressPercentage }}%</span>
											{% else %}
												<span class="value">0%</span>
											{% endif %}
										</div>
									{% endif %}
								</div>
								<a href="{{ path('game_zone_show', {'zoneId': currentZone.id}) }}" class="btn btn-primary btn-lg">
									â–¶ï¸ Continuer les Questions
								</a>
							</div>
						</div>
					{% endif %}

					<!-- Autres Zones DÃ©bloquÃ©es -->
					{% if unlockedZones|length > 1 %}
						<div class="other-zones-section">
							<h3>Autres Zones DÃ©bloquÃ©es</h3>
							<div class="zones-grid">
								{% for item in unlockedZones %}
									{% if not (currentZone and currentZone.id == item.zone.id) %}
										<div class="zone-card unlocked">
											<div class="zone-header">
												<h4>{{ item.zone.name }}</h4>
												<span class="zone-badge badge-unlocked">DÃ‰BLOQUÃ‰E</span>
											</div>
											<p class="zone-description">{{ item.zone.description }}</p>
											<div class="zone-progress-mini">
												<div class="progress-bar">
													<div class="progress-fill" style="width: {{ item.progress.progressPercentage }}%"></div>
												</div>
												<span class="progress-text">{{ item.progress.progressPercentage }}% complÃ¨te</span>
											</div>
											<a href="{{ path('game_zone_show', {'zoneId': item.zone.id}) }}" class="btn btn-secondary">
												AccÃ©der Ã  la Zone
											</a>
										</div>
									{% endif %}
								{% endfor %}
							</div>
						</div>
					{% endif %}

					<!-- Zones ComplÃ©tÃ©es -->
					{% if completedZones|length > 0 %}
						<div class="completed-zones-section">
							<h3>âœ… Zones ComplÃ©tÃ©es</h3>
							<div class="zones-grid">
								{% for item in completedZones %}
									<div class="zone-card completed">
										<div class="zone-header">
											<h4>{{ item.zone.name }}</h4>
											<span class="zone-badge badge-completed">âœ“ COMPLÃ‰TÃ‰E</span>
										</div>
										<p class="zone-description">{{ item.zone.description }}</p>
										<div class="zone-stats-mini">
											<div class="stat">
												<span class="label">Score Total:</span>
												<span class="value">{{ item.progress.zoneScore }}</span>
											</div>
											<div class="stat">
												<span class="label">RÃ©ussite:</span>
												<span class="value">{{ item.progress.progressPercentage }}%</span>
											</div>
										</div>
										<div class="zone-actions">
											<p class="zone-completed-message">ğŸ‰ Bravo, tu as complÃ©tÃ© cette zone!</p>
										</div>
									</div>
								{% endfor %}
							</div>
						</div>
					{% endif %}

					<!-- Zones VerrouillÃ©es -->
					<div class="locked-zones-info">
						<p class="info-text">ğŸ”’ Les autres zones se dÃ©verrouillent au fur et Ã  mesure de ta progression!</p>
					</div>
				{% endif %}
			</section>

			<div class="game-actions">
				<a href="{{ path('gallery_shop_index') }}" class="btn btn-shop">ğŸ›’ Boutique</a>
				<a href="{{ path('app_score_index') }}" class="btn btn-scores">ğŸ† Leaderboard</a>
				<a href="{{ path('app_profile_index') }}" class="btn btn-profile">ğŸ‘¤ Mon Profil</a>
			</div>
		{% endif %}
	</main>
{% endblock %}
