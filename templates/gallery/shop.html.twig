{% extends 'base.html.twig' %}

{% block title %}Boutique - Articles Zelda
{% endblock %}

{% block body %}
<div class="shop-container">
	<!-- Header -->
	<header class="shop-header">
		<div class="shop-header-content">
			<h1>ğŸ›’ Boutique d'Articles</h1>
			<p class="subtitle">Collectionne des objets magiques et rares!</p>
		</div>

		<div class="shop-info-bar">
			<div class="player-info">
				<span class="label">Joueur:</span>
				<span class="value">{{ player.name }}</span>
			</div>
			<div class="shop-points-display">
				<span class="label">Points Boutique:</span>
				<span class="value points">
					{{ shopPoints }}
				<img class="card-rubis" src="{{ asset('images/rubis.png') }}" alt="Rubis">
				</span>
			</div>
		</div>

		<nav class="shop-nav">
			<a href="{{ path('gallery_index') }}" class="btn btn-secondary">ğŸ“– Ma Galerie</a>
			<a href="{{ path('game_index') }}" class="btn btn-primary">ğŸ® Retour au Jeu</a>
		</nav>
	</header>

	<!-- Main Content -->
	<main class="shop-main">
		{% if items|length > 0 %}
			<section class="shop-items">
				<h2>Articles Disponibles</h2>
				
				<div class="shop-grid">
					{% for item in items %}
						<div class="shop-card card {% if item.id in purchasedItemIds %}is-owned{% endif %}">
							<!-- Card Image -->
							<div class="card-image">
								{% if item.imagePath %}
								<img src="{{ asset('images/' ~ item.imagePath) }}" 
								{% else %}
									<div class="placeholder-image">
										<span>ğŸ“¦</span>
									</div>
								{% endif %}

								{% if item.id in purchasedItemIds %}
									<div class="badge badge-owned">
										âœ“ PossÃ©dÃ©
									</div>
								{% endif %}
							</div>

							<!-- Card Body -->
							<div class="card-body">
								<h3 class="item-title">{{ item.title }}</h3>
								{% if item.title %}
									<p class="item-description">{{ item.title }}</p>
								{% endif %}
							</div>

							<!-- Card Footer -->
							<div class="card-footer">
								<div class="price-section">
									<span class="price-label">Prix:</span>
									<div class="price-badge">
										<img class="price-icon" 
										 src="{{ asset('images/rubis.png') }}" 
											 alt="Rubis">
										<span class="price-value">{{ item.price }}</span>
									</div>
								</div>

								{% if item.id in purchasedItemIds %}
									<button class="btn btn-secondary btn-sm" disabled>
										âœ“ PossÃ©dÃ©
									</button>
								{% else %}
									<form action="{{ path('gallery_shop_buy', {itemId: item.id}) }}" 
										  method="post"
										  class="buy-form"
										  onsubmit="return confirm('Acheter Â« {{ item.title }} Â» pour {{ item.price }} points?')">
										<button type="submit" 
												class="btn btn-primary btn-sm"
												{% if shopPoints < item.price %}disabled{% endif %}>
											{% if shopPoints < item.price %}
												âŒ Insuffisant
											{% else %}
												ğŸ’³ Acheter
											{% endif %}
										</button>
									</form>
								{% endif %}
							</div>
						</div>
					{% endfor %}
				</div>
			</section>
		{% else %}
			<section class="empty-state">
				<div class="empty-state-content">
					<h2>ğŸª Boutique Vide</h2>
					<p>Aucun article n'est disponible pour le moment.</p>
					<a href="{{ path('game_index') }}" class="btn btn-primary">
						Retourner au Jeu
					</a>
				</div>
			</section>
		{% endif %}

		<!-- Actions -->
		<section class="shop-actions">
			<a href="{{ path('gallery_index') }}" class="btn btn-secondary">
				â† Ma Galerie
			</a>
			<a href="{{ path('game_index') }}" class="btn btn-secondary">
				Retour au Jeu â†’
			</a>
		</section>
	</main>
</div>
{% endblock %}
