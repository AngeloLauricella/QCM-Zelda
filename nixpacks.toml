# Railway Nixpacks Configuration for Symfony 6 + Webpack Encore
# PHP 8.4 avec extensions nÃ©cessaires pour MySQL, Intl, Zip

# ðŸ”§ PHP 8.4 avec extensions
providers = ["php", "nodejs"]

[phases.setup]
# ðŸ”§ Extensions PHP requises
nixPkgs = [
    "php84",
    "php84Extensions.pdo_mysql",
    "php84Extensions.intl",
    "php84Extensions.zip",
    "php84Extensions.opcache",
    "php84Extensions.apcu",
    "nodejs",
    "yarn"
]

[phases.build]
# ðŸ”§ Installer dÃ©pendances Composer (prod)
cmds = [
    "composer install --no-dev --optimize-autoloader --no-interaction",
    "yarn install --frozen-lockfile",
    "yarn run build"
]

# ðŸ”§ Nettoyer les caches avant dÃ©marrage
[phases.start]
cmds = [
    "rm -rf var/cache/*",
    "php bin/console cache:clear --no-warmup --no-interaction"
]

[start]
# ðŸ”§ Commande de dÃ©marrage Railway
cmd = "php -S 0.0.0.0:${PORT:-8080} -t public"
